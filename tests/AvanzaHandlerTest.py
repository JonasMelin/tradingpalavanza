import AvanzaHandler
from Logger import Log
from unittest.mock import patch, MagicMock

getTransactionsReply = {'transactions': [{'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': -54.99, 'currency': 'USD', 'description': 'Sålt 1', 'orderbook': {'isin': 'US0886061086', 'currency': 'USD', 'name': 'BHP Group Ltd', 'flagCode': 'US', 'id': '35068', 'type': 'STOCK'}, 'price': 54.99, 'volume': -1, 'transactionType': 'SELL', 'verificationDate': '2021-11-11', 'id': 'DEAL-9288043-391275580'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': -40.88, 'currency': 'CAD', 'description': 'Sålt 8', 'orderbook': {'isin': 'CA47009M8896', 'currency': 'CAD', 'name': 'Jaguar Mining Inc', 'flagCode': 'CA', 'id': '85697', 'type': 'STOCK'}, 'price': 5.11, 'volume': -8, 'transactionType': 'SELL', 'verificationDate': '2021-11-11', 'id': 'DEAL-9288043-391275524'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': -47.55, 'currency': 'CAD', 'description': 'Sålt 3', 'orderbook': {'isin': 'CA8910546032', 'currency': 'CAD', 'name': 'Torex Gold Resources Inc', 'flagCode': 'CA', 'id': '282537', 'type': 'STOCK'}, 'price': 15.85, 'volume': -3, 'transactionType': 'SELL', 'verificationDate': '2021-11-11', 'id': 'DEAL-9288043-391115211'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': 174.46, 'currency': 'SEK', 'description': 'Sålt 11 st till kurs 15,86000 CAD Rättelse BOSTON PIZZA ROYALTIES INCOME FUND', 'amount': -1712.0, 'orderbook': {'isin': 'CA1010841015', 'currency': 'CAD', 'name': 'Boston Pizza Royalties Income Fund', 'flagCode': 'CA', 'id': '194368', 'type': 'STOCK'}, 'currencyRate': 9.87121, 'price': 15.86, 'volume': 11.0, 'commission': -10.0, 'noteId': 'RBBDWMDJ', 'transactionType': 'SELL', 'verificationDate': '2021-11-10', 'id': '2926528986RBBDWMDJ4'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': -174.46, 'currency': 'SEK', 'description': 'Sålt 11 st till kurs 15,86000 CAD BOSTON PIZZA ROYALTIES INCOME FUND', 'amount': 1193.0, 'orderbook': {'isin': 'CA1010841015', 'currency': 'CAD', 'name': 'Boston Pizza Royalties Income Fund', 'flagCode': 'CA', 'id': '194368', 'type': 'STOCK'}, 'currencyRate': 6.877364, 'price': 15.86, 'volume': -11.0, 'commission': 7.0, 'noteId': 'GRGSJQFM', 'transactionType': 'SELL', 'verificationDate': '2021-11-10', 'id': '2924450929GRGSJQFM4'}, {'account': {'type': 'Investeringssparkonto', 'name': 'Sophia ISK', 'id': '9950862'}, 'sum': 12.0, 'currency': 'SEK', 'description': 'Utdelning 12 st à 1,00 INVESTOR B', 'amount': 12.0, 'orderbook': {'isin': 'SE0015811963', 'currency': 'SEK', 'name': 'Investor B', 'flagCode': 'SE', 'id': '5247', 'type': 'STOCK'}, 'price': 1.0, 'volume': 12.0, 'transactionType': 'DIVIDEND', 'verificationDate': '2021-11-10', 'id': '2924121972ABBBPNPT79827'}, {'account': {'type': 'Investeringssparkonto', 'name': 'Theodor ISK', 'id': '9920769'}, 'sum': 12.0, 'currency': 'SEK', 'description': 'Utdelning 12 st à 1,00 INVESTOR B', 'amount': 12.0, 'orderbook': {'isin': 'SE0015811963', 'currency': 'SEK', 'name': 'Investor B', 'flagCode': 'SE', 'id': '5247', 'type': 'STOCK'}, 'price': 1.0, 'volume': 12.0, 'transactionType': 'DIVIDEND', 'verificationDate': '2021-11-10', 'id': '2924121107ABBBPNPT78963'}, {'account': {'type': 'Investeringssparkonto', 'name': 'Alexander ISK', 'id': '9920025'}, 'sum': 12.0, 'currency': 'SEK', 'description': 'Utdelning 12 st à 1,00 INVESTOR B', 'amount': 12.0, 'orderbook': {'isin': 'SE0015811963', 'currency': 'SEK', 'name': 'Investor B', 'flagCode': 'SE', 'id': '5247', 'type': 'STOCK'}, 'price': 1.0, 'volume': 12.0, 'transactionType': 'DIVIDEND', 'verificationDate': '2021-11-10', 'id': '2924121077ABBBPNPT78933'}, {'account': {'type': 'Investeringssparkonto', 'name': 'Jonas ISK', 'id': '4397855'}, 'sum': 27.0, 'currency': 'SEK', 'description': 'Utdelning 27 st à 1,00 INVESTOR B', 'amount': 27.0, 'orderbook': {'isin': 'SE0015811963', 'currency': 'SEK', 'name': 'Investor B', 'flagCode': 'SE', 'id': '5247', 'type': 'STOCK'}, 'price': 1.0, 'volume': 27.0, 'transactionType': 'DIVIDEND', 'verificationDate': '2021-11-10', 'id': '2923959680ABBBPNPS17711'}, {'account': {'type': 'AktieFondkonto', 'name': 'Jonas buffertkonto', 'id': '4397847'}, 'currency': 'SEK', 'description': 'Överföring från Collector 6700698', 'amount': 49.0, 'transactionType': 'DEPOSIT', 'verificationDate': '2021-11-10', 'id': '2923736182ECQKDLQK1'}, {'account': {'type': 'SparkontoPlus', 'name': 'AlexanderVeckopeng', 'id': '6700698'}, 'currency': 'SEK', 'description': 'Överföring till Avanzakonto 4397847', 'amount': -49.0, 'transactionType': 'WITHDRAW', 'verificationDate': '2021-11-10', 'id': '2923736166ECQKDLPN1'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': -174.46, 'currency': 'SEK', 'description': 'Sålt 11 st till kurs 15,86000 CAD BOSTON PIZZA ROYALTIES INCOME FUND', 'amount': 1712.0, 'orderbook': {'isin': 'CA1010841015', 'currency': 'CAD', 'name': 'Boston Pizza Royalties Income Fund', 'flagCode': 'CA', 'id': '194368', 'type': 'STOCK'}, 'currencyRate': 9.87121, 'price': 15.86, 'volume': -11.0, 'commission': 10.0, 'noteId': 'GRGRLKHK', 'transactionType': 'SELL', 'verificationDate': '2021-11-09', 'id': '2923445394GRGRLKHK4'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': -99.97, 'currency': 'SEK', 'description': 'Sålt 1 st till kurs 99,97000 USD AMERESCO INC', 'amount': 846.0, 'orderbook': {'isin': 'US02361E1082', 'currency': 'USD', 'name': 'Ameresco Inc', 'flagCode': 'US', 'id': '326657', 'type': 'STOCK'}, 'currencyRate': 8.555059, 'price': 99.97, 'volume': -1.0, 'commission': 9.0, 'noteId': 'GRGJKXNJ', 'transactionType': 'SELL', 'verificationDate': '2021-11-08', 'id': '2920499791GRGJKXNJ4'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'currency': 'SEK', 'description': 'Utländsk källskatt DNB BANK ASA 25%', 'amount': -56.48, 'orderbook': {'isin': 'NO0010161896', 'currency': 'NOK', 'name': 'DNB Bank', 'flagCode': 'NO', 'id': '52628', 'type': 'STOCK'}, 'volume': 25.0, 'transactionType': 'FOREIGN_TAX', 'verificationDate': '2021-11-08', 'id': '2917854474ABBBPNNL2553'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': 225.93, 'currency': 'SEK', 'description': 'Utdelning 25 st à 9,03 DNB BANK ASA', 'amount': 225.93, 'orderbook': {'isin': 'NO0010161896', 'currency': 'NOK', 'name': 'DNB Bank', 'flagCode': 'NO', 'id': '52628', 'type': 'STOCK'}, 'price': 9.037323, 'volume': 25.0, 'transactionType': 'DIVIDEND', 'verificationDate': '2021-11-08', 'id': '2917854473ABBBPNNL2552'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'currency': 'SEK', 'description': 'Riskpremie', 'amount': -0.49, 'transactionType': 'UNKNOWN', 'verificationDate': '2021-11-08', 'id': '2917529679LBGPBZKK1'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': 135.42, 'currency': 'SEK', 'description': 'Köpt 6 st till kurs 22,57000 USD SINOPEC SHANGHI PETROCHEM ADR', 'amount': -1175.0, 'orderbook': {'isin': 'US82935M1099', 'currency': 'USD', 'name': 'Sinopec Shanghai Petrochemical Co Ltd', 'flagCode': 'US', 'id': '496178', 'type': 'STOCK'}, 'currencyRate': 8.610473, 'price': 22.57, 'volume': 6.0, 'commission': 9.0, 'noteId': 'GRFRJDPL', 'transactionType': 'BUY', 'verificationDate': '2021-11-04', 'id': '2915137462GRFRJDPL4'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'sum': 49.34, 'currency': 'SEK', 'description': 'Köpt 2 st till kurs 24,67000 USD AT&T INC', 'amount': -434.0, 'orderbook': {'isin': 'US00206R1023', 'currency': 'USD', 'name': 'AT&T Inc', 'flagCode': 'US', 'id': '3507', 'type': 'STOCK'}, 'currencyRate': 8.610473, 'price': 24.67, 'volume': 2.0, 'commission': 9.0, 'noteId': 'GRFRJDNQ', 'transactionType': 'BUY', 'verificationDate': '2021-11-04', 'id': '2915137388GRFRJDNQ4'}, {'account': {'type': 'Kapitalforsakring', 'name': 'Jonas KF', 'id': '9288043'}, 'currency': 'SEK', 'description': 'Överföring från Avanzakonto 4397855', 'amount': 2900.0, 'transactionType': 'DEPOSIT', 'verificationDate': '2021-11-04', 'id': '2914903191ECQGXTGP1'}, {'account': {'type': 'Investeringssparkonto', 'name': 'Jonas ISK', 'id': '4397855'}, 'currency': 'SEK', 'description': 'Överföring till Avanzakonto 9288043', 'amount': -2900.0, 'transactionType': 'WITHDRAW', 'verificationDate': '2021-11-04', 'id': '2914903190ECQGXTGN1'}], 'totalNumberOfTransactions': 20}

def getTransactions():
    objUnderTest = AvanzaHandler.AvanzaHandler(Log())
    objUnderTest.avanza = MagicMock()
    objUnderTest.avanza.get_transactions.return_value = getTransactionsReply

    retVal = objUnderTest.getTransactions()

    assert retVal is not None
    assert len(retVal) == 15

    retVal = objUnderTest.getTransactions(filterByDate='2021-11-11')
    assert retVal is not None
    assert len(retVal) == 3



if __name__ == "__main__":
    getTransactions()